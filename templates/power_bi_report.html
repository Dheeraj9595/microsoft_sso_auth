<!-- Include the Power BI JavaScript library -->
 <script src="https://microsoft.github.io/PowerBI-JavaScript/demo/node_modules/jquery/dist/jquery.js"></script>
 <script src="https://microsoft.github.io/PowerBI-JavaScript/demo/node_modules/powerbi-client/dist/powerbi.js"></script>
 <script src="https://github.com/microsoft/PowerBI-JavaScript/blob/master/dist/powerbi.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/powerbi-client@2.21.0/dist/powerbi.min.js"></script>

<!-- Add an HTML element to contain the embedded report -->
<div id="reportContainer" powerbi-access-token ='{{access_token}}'></div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
    // Your code that uses the powerbi object goes here
    debugger
    const reportContainer = $('#reportContainer')[0];
    const config = {
      type: 'report',
      groupId:'5d01b1d3-4f41-4857-9cda-e6b914f633e4',
      id: 'd2d09420-8cce-40f1-9447-a1b04daaf5d3', // Replace with the actual report ID
      token: '{{access_token}}', // Replace with the obtained access token
      embedUrl: "https://app.powerbi.com/reportEmbed?reportId=${id}",
    };
    const report = powerbi.embed(reportContainer, config);
  });

  // Configure the embed options
  // const config = {
  //   type: 'report',
  //   id: 'd2d09420-8cce-40f1-9447-a1b04daaf5d3', // Replace with the actual report ID
  //   accessToken: '{{access_token}}', // Replace with the obtained embed token
  //   embedUrl: 'https://app.powerbi.com/reportEmbed',
  // };

  // // Embed the report
  // const reportContainer = document.getElementById('reportContainer');
  // const report = powerbi.embed(reportContainer, config);
</script>


<!-- <script>
// Define the access token and report ID
debugger
const accessToken = '{{access_token}}'; // Replace with the actual access token
const reportId = 'd2d09420-8cce-40f1-9447-a1b04daaf5d3'; // Replace with the actual report ID
const csrfToken = '{{ csrf_token }}';
// Define the API endpoint for fetching the report
const apiUrl = `{% url 'power_bi_proxy' %}?access_token=${accessToken}&csrf=${csrfToken}`;

// Set up the request headers with the access token
const headers = {
  'Authorization': `Bearer ${accessToken}`,
  'Content-Type': 'application/json',
  'X-CSRFToken': csrfToken
};

// Define the request body (if needed)
const requestBody = {
  accessLevel: 'View',
};
// Make a POST request to obtain an embed token
fetch(apiUrl, {
  method: 'POST',
  headers: headers,
  body: JSON.stringify(requestBody), // Include the request body if required
})
.then(response => {
  debugger
  if (response.ok) {
    return response.json();
  } else {
    throw new Error('Failed to fetch the Power BI report token');
  }
})
.then(data => {
  debugger
  // The data variable contains the embed token, which you can use to embed the report
  const embedToken = data.token;
  
  // Now, you can use the embedToken to embed the report using Power BI JavaScript or another embedding method.
})
.catch(error => {
  console.error(error);
});
</script> -->